---
title: "Data Rescue: Binkley 1999"
format:
  html:
    toc: true
date: 2025-06
date-format: YYYY-MMMM
bibliography:
  - Binkley1999_Methods.bib
  - Binkley1999.bib
author:
  - id: ktoddbrown #use the github name as an id
    name:
      given: Katherine
      family: Todd-Brown
    orcid: 0000-0002-3109-8130
    affiliation:
      - ref: uf-ees
    role:
      - transcription: secondary, review
      - standardization: review
   #   - curation: lead #review

  - id: hannguyenuf #use the github name as an id
    name:
      given: Han
      family: Nguyen
    affiliation:
      - ref: uf-e
    role:
      - transcription: lead #secondary, review

  - id: SavaScott #use the github name as an id
    name:
      given: Savannah
      family: Scott
    affiliation:
      - ref: uf-ees
    role:
      - transcription: review
      - standardization: lead
affiliations:
  - id: uf-ees
    name: University of Florida
    department: Environmental Engineering Sciences
    city: Gainesville
    state: Florida
    country: USA
    address: "365 Weil Hall \nP.O. Box 116580"
    postal-code: 32611
    url: https://essie.ufl.edu/ees/
  - id: uf-e
    name: University of Florida
    city: Gainesville
    state: Florida
    country: USA
    address: "300 Weil Hall \nP.O. Box 116550"
    postal-code: 32611
    url: https://www.eng.ufl.edu/
  - activity: 
      description: Lev1 standardization
      who: SavaScott
      start: 2026-01-24
      #start: YYYY-MM-DD THH:MM
      #alternatively duration can be combined with a being/end
      duration: PT2H 
---

```{r setup, include=TRUE, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)
library(kableExtra)
library(bibtex)
library(formula.tools)

# data files for level 0
methods.file <- "Binkley1999_Methods.md"
table1.file <- 'Binkley1999_Table1.csv'

# Bibliograph files
primaryCitation.file <- 'Binkley1999.bib'
methodsCitation.file <- 'Binkley1999_Methods.bib'

# read function; you will need to create this function after you have your data
#... rescue reviewed and before you finish your data harmonization.
readsource.file <- '../../../R/readAuthorYYYY.R'
if(file.exists(readsource.file)){
  source(readsource.file)
}

#semantic files for level 1
of_variable.file <- '../../semantics/SoilDRaHVocabulary_of_variable.csv'
is_type.file <- '../../semantics/SoilDRaHVocabulary_is_type.csv'

```

This documents the data transcription for @Binkley1999 .
For the discussion of this data rescue see the Github issue: https://github.com/ktoddbrown/SoilDRaH/issues/76.

> Binkley, D. and Resh, S.C. (1999), Rapid Changes in Soils Following Eucalyptus Afforestation in Hawaii. Soil Science Society of America Journal, 63: 222-225. https://doi.org/10.2136/sssaj1999.03615995006300010032x

# Data Summary

@Binkley1999 looks at soil carbon stocks under ~3 years of Eucalytus plantation from sugarcane. They use this data to conclude that there was no change in carbon stocks but there was a shift from sugarcane derived carbon to Eucalytus.

This paper documents changes in Hawaiian soil after 32 months of development of a eucalyptus plantation.
Soil C was found to not change significantly, suggesting that expectations of C accumulation due to afforestation may need to be reduced.
Rapid changes in soil are examined here as: (1) Soil fertility may affect tree growth rate, and (2) Changes in soil C must be accounted for to predict root production following an efflux in CO2.

## Fit for purpose: HiCSC

This data is identified as a data source for the Hawai'i Soil Organic Carbon Database https://osf.io/hmtv6/ as part of the HiCSC.

- Location: The exact lat/lon is given in the methods section, although it is unclear if this is the location of downtown Hilo or the site. Years of observation is given in text.
- Soil carbon stock: Carbon stock is given in Table 1 at 0 months and 32 months of plantation. Depth of sample included, bulk density determined but unclear where the data is.
- Soil type: Soils of the Kaiwiki thixotropic, isothermic Typic Hydrandepts. Unclear if "Kaiwiki thixotropic" qualifies as soil type here, but the location might be precise enough to extract from soil maps
- Land Use: Detailed soil history and classification provided in methods section. Land use largely characterized by eucalyptus afforestation.

# Tables and figures

- Table 
  1) Soil Properties at Time of Planting and 32 Months after (C, N, pH, Ca, Mg, K+, Al)
  2)  Nutrient Accumulation on Ion-Exchange Resin Bags (age, fertilization, nutrients)
  
- Figure
  1) Loss of Soil C from Sugar Cane (C4) matched with gain of soil C derived from Eucalyptus (C3). bar plot of soil carbon source parition.

### Table 1

Table 1 was modified by filling in blanks with `NA` and down filling the Age column.
There were two rows in the 'K' column that indicated control vs fertilizer, I split this into two separate columns.
The CI for pH was not aggregated to 0-30 but reported for 0-15 and 15-30, I concatenated both values with a ';' separate into one entry.

```{r table1}
#| code-fold: true
#| message: false

filename <- table1.file
read_csv(file = filename,
                   skip = 1,
                   col_types = cols(.default = col_character())) |>
  kable(caption = read_csv(file = filename, 
                                 n_max = 1, col_names = 'caption', 
                                 show_col_types = FALSE)$caption)
```


{{< include Binkley1999_Methods.md >}}

# Transcription comparison

```{bash eval=FALSE}
diff --strip-trailing-cr Binkley1999_Methods.md Binkley1999_Methods_HN.md
```

# Files

These files are in the @Binkley1999 data rescue.

- [Readme](README_Binkley1999.qmd)
  + This is the primary file that documents the transcriptions and decision made during data rescue.
- [Binkley1999.bib](Binkley1999.bib)
  + citation for article transcribed
- [Binkley1999_Methods.bib](Binkley1999_Methods.bib)
  + citations for the methods section of the article
- [Binkley1999_Methods.md](Binkley1999_Methods.md)
  + methods transcribed from primary article
- [Binkley1999_Table1.csv](Binkley1999_Table1.csv)
  + table 1 from primary article with data about the soil properties at time of planting and 32 months after (C, N, pH, Ca, Mg, K+, Al)

# Working notes 

## Data Rescue Plan

- [x] describe files in human readable form inside ReadMe
- [x] description with Git issue with link
- [x] add contribution yaml
- [x] create excel sheet with Table 1
- [x] export excel table to csv
- [x] copy over methods section into markdown
- [x] pull down citations in methods section to bib file
- [x] add in citation links to methods
- [x] cross check with second transcriber for tables and methods
- [ ] submit to independent review
- [ ] archive on SoilDRaH


## Citation notes from Methods

Below are the citation notes from the methods section.
Some citations are missing, those are noted here and how best guess were generated.

- [ ] short citation
  + copy from bib
  + manually entered or direct export

- [x] Binkley, D., K.A. Dunkin, D. Debell, and M.G. Ryan. 1992. Production and nutrient cycling in mixed plantations of *Eucalyptus* and *Albizia* in Hawaii. For. Sci. 38:393-408.
  + copy from bib
- [x] Vitorello, V.A., C.C. Cerri, F. Andreux, C. Feller, and R.L. Victoria. 1989. Organic matter and natural carbon-13 distribution in forested and cultivated Oxisols. Soil Sci. Soc. Am. J. 53:773-778
  + copy from bib
- [x] Bashkin, M., and D. Binkley. 1998. Changes in soil carbon following afforestation in Hawaii. Ecology 79:828-833.
  + copy from bib

# Level 0: raw data reads

The Level 0 data in this package include the tables above (Table 1 and 3) as well as the methods section.
Here we draft the read function that will be transferred to the R scripts.
In the future this draft will be echoed from the R scripts.

```{r readLevel0}

data.lvl0.df <- list(citation = 
                    list(primary = 
                           read.bib(file = primaryCitation.file), 
                         methods = 
                           read.bib(file = methodsCitation.file)
                    ),
                  method = read_lines(file = methods.file),
                  data = list(Table1 = 
                                list(caption = 
                                       read_csv(file = table1.file,
                                                col_types = cols(.default = col_character()),
                                                n_max = 1, col_names = FALSE)$X1[1],
                                     primary = 
                                       read_csv(file = table1.file,
                                                col_types = cols(.default = col_character()),
                                                skip = 1,
                                                na = '-')
                                )
                  ) 
)
```

# Level 1
The final format of the data frame here will include the following 

  + grouping ids
  + `of_variable`
  + `is_type`
  + `with_entry`
  + `source`

The `of_variable` being used here are:

+ citation
+ doi
+ region
+ latitude
+ longitude
+ mean_air_temperature
+ mean_rainfall
+ elevation 
+ soil_class
+ initial_planting
+ observation_year
+ core_description
+ soil_ph
+ sample_prep

```{r}
#| label: constructLevel1

#### Method section only ####

studyMeta <- tribble(~of_variable, ~is_type, ~with_entry, ~from_source,
                     'region', 'value', '13 km NNE of downtown Hilo, HI', paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'latitude', 'value', '19°50\'28.1" North', paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                 'longitude', 'value', '155°7\'28.3" West', paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'mean_air_temperature', 'value', '21',paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'mean_air_temperature', 'unit', '°C',paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'mean_rainfall', 'value', '4', paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'mean_rainfall', 'unit', 'yr<sup>-1</sup>', paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'elevation', 'value', '350', paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'elevation', 'unit', 'm', paste('Method ln3:', paste(data.lvl0.df$method[3], collapse = ' ')),
                'soil_class', 'value', 'Kaiwiki thixotropic, isothermic Typic Hydrandepts', paste('Method ln4:',paste(data.lvl0.df$method[4], collapse = ' ')),
                'initial_planting', 'value', '1994', paste('Method ln11:', data.lvl0.df$method[11]),
                'soil_pH_water', 'value', '5-6', paste('Method ln4:', data.lvl0.df$method[4]),
                'observation_year', 'value', '1997', paste('Method ln23:', data.lvl0.df$method[23]),
                'sample_prep', 'value', 'oven dried at 100 C to constant weight', paste('Method ln22:', data.lvl0.df$method[22]),
                'core_description', 'value', '30 by 30 m plots with trees at two spacings (1 by 1 m and 3 by 3 m)', paste('Method ln12:', data.lvl0.df$method[12]),
                 'citation', 'value', format(data.lvl0.df$citation$primary), 'journal citation',
                   'doi', 'value', data.lvl0.df$citation$primary$doi, 'journal citation')
    
#### Table 1 ####
                
Table1Primary <- data.lvl0.df$data$Table1$primary |>
   mutate(row_id = paste0('R', 1:n())) |>
    pivot_longer(cols = -row_id,
               names_to = 'column_name', values_to = 'with_entry',
               values_drop_na = TRUE) |>
    mutate(of_variable = case_when(
      column_name == "Age (mo)" ~ "plant_age",
      column_name == "Depth (cm)" ~ "soil_depth",
      column_name == "C (g m<sup>-2</sup>)" ~ "organic_carbon_density",
      column_name == "N (g m<sup>-2</sup>)" ~ "nitrogen_density",
      column_name == "pH<sub>CaCl2</sub>" ~ "soil_pH_calcium_chloride",
      column_name == "Ca (mmol m<sup>-2</sup>)" ~ "soil_calcium_stock",
      column_name == "Mg (mmol m<sup>-2</sup>)" ~ "soil_magensium_stock",
      column_name == "C K† (mmol m<sup>-2</sup>)" ~ "control_potassium_stock",
      column_name == "F K† (mmol m<sup>-2</sup>)" ~ "fertilized_potassium_stock",
      column_name == "Al (mmol m<sup>-2</sup>)" ~ "soil_aluminum_stock")  )|>
   mutate(from_source = 'Table 1')

Table1Meta <- Table1Primary |>
  select(column_name, of_variable) |>
  unique() |>
  #Grab everything between the parentheses as units and attribute the source as the column names.
  mutate(unit = str_extract(column_name, pattern = '(?<=\\().*(?=\\))'),
         from_source = 'Table 1 column names.') |>
  #If there aren't units then drop the row
  filter(!is.na(unit)) |>
  #Don't keep the column name now that you have the units, cross link via the variable
  select(-column_name) |>
  
  bind_rows(
  tribble(~of_variable, ~method, ~from_source,
          'soil_pH_calcium_chloride', paste0(data.lvl0.df$method[25:26], collapse = ' '), 'Methods ln25-26',
          'soil_calcium_stock', paste0(data.lvl0.df$method[27], collapse = ' '), 'Methods ln27',
          'soil_magensium_stock', paste0(data.lvl0.df$method[27], collapse = ' '), 'Methods ln27',
          'soil_aluminum_stock', paste0(data.lvl0.df$method[27], collapse = ' '), 'Methods ln27',
          'control_potassium_stock', paste0(data.lvl0.df$method[c(14:15,27)], collapse = ' '), 'Methods ln14-15;27',
  'fertilized_potassium_stock', paste0(data.lvl0.df$method[c(16:17,27)], collapse = ' '), 'Methods ln16-17;27',
  'plant_age', paste0(data.lvl0.df$method[11], collapse = ' '), 'Methods ln11',
  'soil_depth', paste0(data.lvl0.df$method[c(19:20,23:24)], collapse = ' '), 'Methods ln 19-20;23-24',
  'organic_carbon_density', paste0(data.lvl0.df$method[29:30], collapse = ' '), 'Methods ln 29-30',
  'nitrogen_density', paste0(data.lvl0.df$method[29:30], collapse = ' '), 'Methods ln 29-30') ) |>

 bind_rows(
    tribble(~of_variable, ~control_vocabulary, ~from_source,
          'soil_class', 'Kaiwiki thixotropic: USDA classification for deep, well drained soils formed from weathered volcanic ash|isothermic Typic Hydrandept: USDA taxonomic class of deep, well drained soils formed in material weathered from basic volcanic ash', 'USDA')
    ) |>

pivot_longer(cols = c(unit, method, control_vocabulary),
               names_to = 'is_type',
               values_drop_na = TRUE,
               values_to = 'with_entry')

#### Create level 1 ?? Error with elevation_id and not being able to find is_type

data.lvl1.df <- list(
  meta = bind_rows(studyMeta, Table1Meta),
  primary = bind_rows(Table1Primary)|>
    mutate(elevation_id = with_entry[of_variable == 'elevation'],
           is_type = 'value',
           .by = row_id) |>
    arrange(row_id, elevation_id, column_name, 
            of_variable, is_type, with_entry, from_source)
  )
#View(data.lvl1.df)

```

